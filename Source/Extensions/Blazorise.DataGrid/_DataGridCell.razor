@typeparam TItem
@inherits _BaseDataGridCell<TItem>
@if ( Column.EditTemplate != null )
{
    @Column.EditTemplate( CellEditContext )
}
else
{
    var valueType = Column.GetValueType();
    @if ( valueType is not null )
    {
        @if ( UseValidation )
        {
            <Validation HandlerType="@ValidationHandlerType" Validator="@Validator" AsyncValidator="@AsyncValidator" UsePattern="@HasValidationPattern">
                @if ( Column is DataGridNumericColumn<TItem> numericColumn )
                {
                    <_DataGridCellEditValidation Column="@Column" Item="@Item" ValidationItem="@ValidationItem" Field="@Column.Field" ValueType="@valueType" CellEditContext="CellEditContext" Readonly="@Column.Readonly" CellValueChanged="@CellValueChanged" ShowValidationFeedback="@ShowValidationFeedback" ValidationPattern="@ValidationPattern" Step="@numericColumn.Step" Decimals="@numericColumn.Decimals" DecimalSeparator="@numericColumn.DecimalSeparator" Culture="@numericColumn.Culture" ShowStepButtons="@numericColumn.ShowStepButtons" EnableStep="@numericColumn.EnableStep" />
                }
                else if ( Column is DataGridDateColumn<TItem> dateColumn )
                {
                    <_DataGridCellEditValidation Column="@Column" Item="@Item" ValidationItem="@ValidationItem" Field="@Column.Field" ValueType="@valueType" CellEditContext="CellEditContext" Readonly="@Column.Readonly" CellValueChanged="@CellValueChanged" ShowValidationFeedback="@ShowValidationFeedback" ValidationPattern="@ValidationPattern" DateInputMode="@dateColumn.InputMode" />
                }
                else if ( Column is DataGridSelectColumn<TItem> selectColumn )
                {
                    if ( selectColumn.Type is not null )
                    {
                        @InstantiateGenericSelectColumn( selectColumn )
                    }
                    else
                    {
                            <_DataGridCellSelectEdit Column="@selectColumn" CellValue="CellEditContext.CellValue" CellValueChanged="@OnEditValueChanged" ShowValidationFeedback="@ShowValidationFeedback" />
                    }
                }
                else
                {
                    <_DataGridCellEditValidation Column="@Column" Item="@Item" ValidationItem="@ValidationItem" Field="@Column.Field" ValueType="@valueType" CellEditContext="CellEditContext" Readonly="@Column.Readonly" CellValueChanged="@CellValueChanged" ShowValidationFeedback="@ShowValidationFeedback" ValidationPattern="@ValidationPattern" />
                }
            </Validation>
        }
        else
        {
            @if ( Column is DataGridNumericColumn<TItem> numericColumn )
            {
                <_DataGridCellNumericEdit Column="@numericColumn" CellValue="@CellEditContext.CellValue" CellValueChanged="@OnEditValueChanged" />
            }
            else if ( Column is DataGridDateColumn<TItem> dateColumn )
            {
                <_DataGridCellEdit Column="@Column" Item="@Item" ValidationItem="@ValidationItem" Field="@Column.Field" ValueType="@valueType" CellEditContext="CellEditContext" Readonly="@Column.Readonly" CellValueChanged="@CellValueChanged" DateInputMode="@dateColumn.InputMode" />
            }
            else if ( Column is DataGridSelectColumn<TItem> selectColumn )
            {
                if ( selectColumn.Type is not null )
                {
                    @InstantiateGenericSelectColumn( selectColumn )
                }
                else
                {
                    <_DataGridCellSelectEdit Column="@selectColumn" CellValue="CellEditContext.CellValue" CellValueChanged="@OnEditValueChanged" />

                }
            }
            else
            {
                <_DataGridCellEdit Column="@Column" Item="@Item" ValidationItem="@ValidationItem" Field="@Column.Field" ValueType="@valueType" CellEditContext="CellEditContext" Readonly="@Column.Readonly" CellValueChanged="@CellValueChanged" />
            }
        }
    }
}

@code {

    private RenderFragment<DataGridSelectColumn<TItem>> InstantiateGenericSelectColumn => column => builder =>
                {
                    var type = typeof( _DataGridCellSelectEditGeneric<,> ).MakeGenericType( new[] { typeof( TItem ), column.Type } );
                    builder.OpenComponent( 0, type );
                    builder.AddAttribute( 1, "Column", column );
                    builder.AddAttribute( 2, "CellValue", CellEditContext.CellValue );
                    builder.AddAttribute( 3, "CellValueChanged", EventCallback.Factory.Create<object>(this, OnEditValueChanged ));
                    builder.AddAttribute( 4, "ShowValidationFeedback", ShowValidationFeedback );
                    builder.CloseComponent();
                };
}