@page "/tests/loadingindicator"
@inject LoadingIndicatorService ApplicationLoadingIndicatorService

<Row>
    <Column ColumnSize="ColumnSize.IsHalf">
        <Card Margin="Margin.Is4.OnY">
            <CardHeader>
                <CardTitle>Using Reference and Binding</CardTitle>
            </CardHeader>
            <CardBody>
                <LoadingIndicator id="spinner" @ref="lineChartIndicator" @bind-Busy="lineChartBusy" @bind-Loaded="lineChartLoaded"
                                  SpinnerWidth="@($"{spinnerWidth}%")" SpinnerHeight="@($"{spinnerHeight}%")"
                                  IndicatorHorizontalPlacement="spinnerHorizontal" IndicatorVerticalPlacement="spinnerVertical"
                                  IndicatorMargin="@spinnerMargin">
                    <LineChart @ref="lineChart" Data="lineChartData" />
                </LoadingIndicator>
            </CardBody>
            <CardBody>
                <Button Clicked="() => lineChartIndicator.SetBusy(true)" Color="Color.Primary" Margin="Margin.Is2.OnX">Set Busy</Button>
                <Check TValue="bool" @bind-Checked="lineChartBusy" Inline>Busy</Check>
                <Check TValue="bool" @bind-Checked="lineChartLoaded" Inline>Loaded</Check>
            </CardBody>
            <CardBody>
                Width <Slider Min="0" Max="100" @bind-Value="spinnerWidth" />
                Height <Slider Min="1" Max="100" @bind-Value="spinnerHeight" />
                Horizontal Placement
                <Select TValue="Placement" @bind-SelectedValue="spinnerHorizontal">
                    <SelectItem TValue="Placement" Value="Placement.Start">Start</SelectItem>
                    <SelectItem TValue="Placement" Value="Placement.Middle">Middle</SelectItem>
                    <SelectItem TValue="Placement" Value="Placement.End">End</SelectItem>
                </Select>
                Vertical Placement
                <Select TValue="Placement" @bind-SelectedValue="spinnerVertical">
                    <SelectItem TValue="Placement" Value="Placement.Top">Top</SelectItem>
                    <SelectItem TValue="Placement" Value="Placement.Middle">Middle</SelectItem>
                    <SelectItem TValue="Placement" Value="Placement.Bottom">Bottom</SelectItem>
                </Select>
                Margin (top right bottom left)<TextEdit @bind-Text="spinnerMargin" />
                <Check TValue="bool" @bind-Checked="showBorder" Inline>Show border</Check>
                @if (showBorder)
                {
                    <style>
                        #spinner, #spinner svg {
                            border: solid 1px red;
                        }
                    </style>
                }
            </CardBody>
        </Card>
    </Column>
    <Column ColumnSize="ColumnSize.IsHalf">
        <Card Margin="Margin.Is4.OnY">
            <CardHeader>
                <CardTitle>Wrapping Inline Content and Disabling on Busy</CardTitle>
            </CardHeader>
            <CardBody>
                Message
                <LoadingIndicator @ref="textEditIndicator" Inline SpinnerHeight="80%" SpinnerHorizontalPlacement="Placement.End">
                    <TextEdit Disabled="textEditIndicator.Busy" Text="disabled when busy" />
                </LoadingIndicator>
                <Button Color="Color.Primary" Disabled="@(textEditIndicator?.Busy ?? false)" Clicked="ShowInlineBusy">Send</Button>
            </CardBody>
        </Card>
        <Card Margin="Margin.Is4.OnY">
            <CardHeader>
                <CardTitle>Using Service Instance and Templating</CardTitle>
            </CardHeader>
            <CardBody>
                <LoadingIndicator Inline SpinnerHeight="100%" Service="sharedLoadingIndicatorService">
                    <Button Clicked="ShowMultipleIndicators" Color="Color.Primary">Set</Button>
                </LoadingIndicator>
                <LoadingIndicator Inline SpinnerHeight="100%" Service="sharedLoadingIndicatorService">
                    <Button Margin="Margin.Is2.OnX" Clicked="ShowMultipleIndicators" Color="Color.Primary">Multiple</Button>
                </LoadingIndicator>
                <LoadingIndicator Inline SpinnerHeight="100%" Service="sharedLoadingIndicatorService">
                    <Button Clicked="ShowMultipleIndicators" Color="Color.Primary">Indicators</Button>
                </LoadingIndicator>
                <CardBody>
                </CardBody>
                <Button Clicked="ShowApplicationIndicator" Color="Color.Secondary">Application Busy Service</Button>
            </CardBody>
            <CardBody>
                <LoadingIndicator @ref="customIndicator" FullScreen Inline>
                    <IndicatorTemplate>
                        <Div Display="Display.Flex" Style="flex-direction:column">
                            <SpinKit Type="SpinKitType.Circle" Size="100px" />
                            <Button Margin="Margin.Is5.OnY" Clicked="() => customIndicator.SetBusy(false)" Color="Color.Primary">Stop</Button>
                        </Div>
                    </IndicatorTemplate>
                    <ChildContent>
                        <Button Clicked="() => customIndicator.SetBusy(true)" Color="Color.Secondary">Using Spinner Template</Button>
                    </ChildContent>
                </LoadingIndicator>
            </CardBody>
        </Card>
        <Card Margin="Margin.Is4.OnY">
            <CardHeader>
                <CardTitle>Customizing Appearance</CardTitle>
            </CardHeader>
            <CardBody>
                <Row>
                    <Column ColumnSize="ColumnSize.IsHalf">
                        <LoadingIndicator @ref="customBasicIndicator" Busy SpinnerColor="@spinnerColor" SpinnerBackgroundColor="@spinnerBackgroundColor" SpinnerHeight="100%" SpinnerWidth="100%" ScreenColor="@screenColor" ScreenOpacity="@(screenOpacity/10.0)">
                            <LineChart @ref="lineChart" Data="lineChartData" />
                        </LoadingIndicator>
                    </Column>
                    <Column ColumnSize="ColumnSize.IsHalf">
                        Spinner color<ColorPicker @bind-Color="spinnerColor" />
                        Spinner background color<ColorPicker @bind-Color="spinnerBackgroundColor" />
                        Screen color<ColorPicker @bind-Color="screenColor" />
                        Screen opacity<Slider TValue="int" Min="0" Max="10" @bind-Value="screenOpacity" />
                    </Column>
                </Row>
            </CardBody>
            <CardBody>
            </CardBody>
        </Card>
    </Column>
</Row>

@code {
    [CascadingParameter]
    public LoadingIndicator CascadingLoadingIndicator { get; set; }

    private LineChart<double> lineChart;
    private LoadingIndicator lineChartIndicator;
    private bool lineChartBusy;
    private bool lineChartLoaded = true;

    private int spinnerWidth = 30;
    private int spinnerHeight = 30;
    private Placement spinnerHorizontal = Placement.Middle;
    private Placement spinnerVertical = Placement.Middle;
    private string spinnerMargin;
    private bool showBorder;

    private string spinnerColor = "skyblue";
    private string spinnerBackgroundColor = "pink";
    private string screenColor = "white";
    private int screenOpacity = 5;


    private LoadingIndicatorService sharedLoadingIndicatorService = new();
    private LoadingIndicatorService inlineLoadingIndicatorService = new();

    private LoadingIndicator textEditIndicator;
    private LoadingIndicator customBasicIndicator;
    private LoadingIndicator customIndicator;

    private ChartData<double> lineChartData = new()
        {
            Labels = new() { "Jan", "Feb", "Mar", "Apr", "May", "Jun" },
            Datasets = new() {
                new LineChartDataset<double>()
                {
                    Data = new List<double>() { 100, 120, 40, 70, 110, 50 },
                }
            }
        };

    async Task ShowApplicationIndicator()
    {
        ApplicationLoadingIndicatorService.SetBusy(true);
        await Task.Delay(3000);
        ApplicationLoadingIndicatorService.SetBusy(false);
    }

    async Task ShowApplicationIndicatorCascading()
    {
        CascadingLoadingIndicator.SetBusy(true);
        await Task.Delay(3000);
        CascadingLoadingIndicator.SetBusy(false);
    }

    async Task ShowMultipleIndicators()
    {
        sharedLoadingIndicatorService.SetBusy(true);
        await Task.Delay(5000);
        sharedLoadingIndicatorService.SetBusy(false);
    }

    async Task ShowCustomBasicIndicator()
    {
        customBasicIndicator.SetBusy(true);
        await Task.Delay(3000);
        customBasicIndicator.SetBusy(false);
    }

    async Task ShowInlineBusy()
    {
        textEditIndicator.SetBusy(true);
        await Task.Delay(3000);
        textEditIndicator.SetBusy(false);
    }
}